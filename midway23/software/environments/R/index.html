
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>R - RCC User Guide</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#r" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="RCC User Guide" class="md-header__button md-logo" aria-label="RCC User Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RCC User Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              R
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="RCC User Guide" class="md-nav__button md-logo" aria-label="RCC User Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    RCC User Guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://rcc.uchicago.edu/accounts-allocations" class="md-nav__link">
        Accounts and Allocations
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Midway2 and Midway3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Midway2 and Midway3" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Midway2 and Midway3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway_getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway_hardware_overview/" class="md-nav__link">
        Hardware Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway_connecting/" class="md-nav__link">
        Connecting to Midway
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Data Management
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Management" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Data Management
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway_data_transfer/" class="md-nav__link">
        Data Transfer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway_data_storage/" class="md-nav__link">
        Data Storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway_file_permissions/" class="md-nav__link">
        File System Permissions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_5">
          Running Jobs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Running Jobs" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Running Jobs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway_jobs_overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway_submitting_jobs/" class="md-nav__link">
        Submitting Jobs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway_job_management/" class="md-nav__link">
        Managing Jobs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/example_job_scripts/" class="md-nav__link">
        Example Job Submission Scripts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" type="checkbox" id="__nav_3_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_6">
          Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Software" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../midway_software_overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6_2" type="checkbox" id="__nav_3_6_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_6_2">
          Commonly Used Applications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Commonly Used Applications" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_6_2">
          <span class="md-nav__icon md-icon"></span>
          Commonly Used Applications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway3_python.md" class="md-nav__link">
        Python and Conda
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway3_jupyter.md" class="md-nav__link">
        Jupyter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway3_tf_pytorch.md" class="md-nav__link">
        Tensorflow and PyTorch
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway3_software_list.md" class="md-nav__link">
        List of All Software
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway3_software_requests.md" class="md-nav__link">
        Request New Software
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../midway_troubleshooting/" class="md-nav__link">
        Troubleshooting and FAQ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Specialized Systems and Partitions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Specialized Systems and Partitions" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Specialized Systems and Partitions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://sde-midwayr.rcc.uchicago.edu/user-guide/" class="md-nav__link">
        MidwayR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://dali.uchicago.edu/using-dali/" class="md-nav__link">
        Beagle3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://dali.uchicago.edu/using-dali/" class="md-nav__link">
        DaLI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://midwayssd.rcc.uchicago.edu/using-midwayssd/" class="md-nav__link">
        MidwaySSD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://dali.uchicago.edu/using-dali/" class="md-nav__link">
        Skyway
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_policy/" class="md-nav__link">
        RCC User Policy
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Help
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Help" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Help
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../general_faq/" class="md-nav__link">
        Frequently Asked Questions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contact_us.md" class="md-nav__link">
        Contact Us
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#serial-examples" class="md-nav__link">
    Serial Examples
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parallel-examples" class="md-nav__link">
    Parallel Examples
  </a>
  
    <nav class="md-nav" aria-label="Parallel Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multicore" class="md-nav__link">
    Multicore
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snow" class="md-nav__link">
    SNOW
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rmpi" class="md-nav__link">
    Rmpi
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="r">R</h1>
<p>R is an interactive environment for computing.</p>
<p>To find the list of currently available R modules, run:</p>
<div class="highlight"><pre><span></span><code>$ module avail R
</code></pre></div>
<p>The RStudio IDE is also available as the <code>rstudio</code> module. This provides
a graphical interface for developing and running R. To use R in this mode,
we recommend connecting to the RCC cluster using <a href="../../../connecting/index.md#thinlinc">Connecting with ThinLinc</a>.</p>
<p><strong>NOTE:</strong> Some of the examples below have not been revised to reflect
updates to the software and hardware on the RCC cluster. If an example
does not work, or if you have questions about an example, please
contact the RCC Help Desk for guidance.</p>
<h2 id="serial-examples">Serial Examples</h2>
<p>Here is a simple “hello world” example to submit an R job to the SLURM
queue. This is appropriate for an R job that expects to use a single
CPU.</p>
<p>sbatch script <code>Rhello.sbatch</code></p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1">#SBATCH --partition=broadwl</span>
<span class="c1">#SBATCH --tasks=1</span>

<span class="c1"># Load the default version of hello.</span>
module load R

<span class="c1"># Use R CMD BATCH to run Rhello.R.</span>
R CMD BATCH --no-save --no-restore Rhello.R
</code></pre></div>
<p>R script <code>Rhello.R</code>:</p>
<div class="highlight"><pre><span></span><code>print(&quot;Hello World&quot;)
</code></pre></div>
<h2 id="parallel-examples">Parallel Examples</h2>
<p>For parallel computing there are several options depending on whether
there should be parallel tasks on a single node only or multiple nodes
and the level of flexibility required. There are other R packages
available for parallel programming than what is covered here, but
we’ll cover some frequently used packages.</p>
<h3 id="multicore">Multicore</h3>
<p>On a single node, it is possible to use doParallel and foreach.</p>
<p>sbatch script <code>doParallel.sbatch</code>:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --partition=broadwl</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks-per-node=16</span>

<span class="c1"># --ntasks-per-node will be used in doParallel.R to specify the number</span>
<span class="c1"># of cores to use on the machine. Using 16 will allow us to use all</span>
<span class="c1"># cores on a sandyb node</span>
module load R

R CMD BATCH --no-save --no-restore doParallel.R
</code></pre></div>
<p>R script <code>doParallel.R</code>:</p>
<div class="highlight"><pre><span></span><code>library(doParallel)

# use the environment variable SLURM_NTASKS_PER_NODE to set the number of cores
registerDoParallel(cores=(Sys.getenv(&quot;SLURM_NTASKS_PER_NODE&quot;)))

# Bootstrapping iteration example
x &lt;- iris[which(iris[,5] != &quot;setosa&quot;), c(1,5)]
iterations &lt;- 10000 # Number of iterations to run

# Parallel version of code 
# Note the &#39;%dopar%&#39; instruction
parallel_time &lt;- system.time({
  r &lt;- foreach(icount(iterations), .combine=cbind) %dopar% {
    ind &lt;- sample(100, 100, replace=TRUE)
    result1 &lt;- glm(x[ind,2]~x[ind,1], family=binomial(logit))
    coefficients(result1)
  }
})

# Shows the number of Parallel Workers to be used
getDoParWorkers()

# Prints the total compute time.
parallel_time[&quot;elapsed&quot;]
</code></pre></div>
<p>Output:</p>
<div class="highlight"><pre><span></span><code>Loading required package: foreach
Loading required package: iterators
Loading required package: parallel
[1] &quot;16&quot;
elapsed 
  5.157 
</code></pre></div>
<h3 id="snow">SNOW</h3>
<p>For multiple nodes, you can use the SNOW package, which provides a
select number of functions to simplify using multi-node
clusters. (NOTE OF CAUTION: This example may not work as described. In
particular, the workers may not actually run on 4 separate nodes.)</p>
<p>sbatch script <code>snow-test.sbatch</code>:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --job-name=snow-test</span>
<span class="c1">#SBATCH --partition=broadwl</span>
<span class="c1">#SBATCH --nodes=4</span>
<span class="c1">#SBATCH --time=10</span>
<span class="c1">#SBATCH --exclusive</span>

module load R

<span class="c1"># the openmpi module is not loaded by default with R</span>
module load openmpi/3.0.0

<span class="c1"># Always use -n 1 for the snow package. It uses Rmpi internally to spawn</span>
<span class="c1"># additional processes dynamically</span>
mpirun -np <span class="m">1</span> R CMD BATCH --no-save --no-restore snow-test.R
</code></pre></div>
<p>R script <code>snow-test.R</code>:</p>
<div class="highlight"><pre><span></span><code>##
# Source: http://www.umbc.edu/hpcf/resources-tara/how-to-run-R.html
# filename: snow-test.R
# 
# SNOW quick ref: http://www.sfu.ca/~sblay/R/snow.html
#
# Notes:
#   - Library loading order matters
#   - system.time([function]) is an easy way to test optimizations
#   - parApply is snow parallel version of &#39;apply&#39;
#
##

library(Rmpi)
library(snow)

# Initialize SNOW using MPI communication. The first line will get the
# number of MPI processes the scheduler assigned to us. Everything
# else is standard SNOW
np      &lt;- 4
cluster &lt;- makeMPIcluster(np)

# Print the hostname for each cluster member
sayhello &lt;- function() {
  info &lt;- Sys.info()[c(&quot;nodename&quot;, &quot;machine&quot;)]
  paste(&quot;Hello from&quot;, info[1], &quot;with CPU type&quot;, info[2])
}

names &lt;- clusterCall(cluster, sayhello)
print(unlist(names))

# Compute row sums in parallel using all processes, then a grand sum
# at the end on the master process
parallelSum &lt;- function(m, n) {
  A &lt;- matrix(rnorm(m*n), nrow = m, ncol = n)
  # Parallelize the summation
  row.sums &lt;- parApply(cluster, A, 1, sum)
  print(sum(row.sums))
}

# Run the operation over different size matricies
system.time(parallelSum(5000, 5000))

# Always stop your cluster and exit MPI to ensure resources are
# properly freed.
stopCluster(cluster)
mpi.exit()
</code></pre></div>
<p>Output (trimmed for readability):</p>
<div class="highlight"><pre><span></span><code>    64 slaves are spawned successfully. 0 failed.
 [1] &quot;Hello from midway197 with CPU type x86_64&quot;
 [2] &quot;Hello from midway197 with CPU type x86_64&quot;
 [3] &quot;Hello from midway197 with CPU type x86_64&quot;
...
[63] &quot;Hello from midway200 with CPU type x86_64&quot;
[64] &quot;Hello from midway197 with CPU type x86_64&quot;
[1] -9363.914
   user  system elapsed 
  3.988   0.443   5.553 
[1] 1
[1] &quot;Detaching Rmpi. Rmpi cannot be used unless relaunching R.&quot;
</code></pre></div>
<h3 id="rmpi">Rmpi</h3>
<p>For multiple nodes, you can also use Rmpi. This is what snow uses internally.
It is less convenient than snow, but also more flexible.</p>
<p>This page has a number of useful Rmpi examples: <a href="http://www.umbc.edu/hpcf/resources-tara-2010/how-to-run-R.php">http://www.umbc.edu/hpcf/resources-tara-2010/how-to-run-R.php</a></p>
<p>sbatch script <code>Rmpi.sbatch</code>:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1">#SBATCH --partition=broadwl</span>
<span class="c1">#SBATCH --nodes=4</span>
<span class="c1">#SBATCH --time=1</span>
<span class="c1">#SBATCH --exclusive</span>

module load R

<span class="c1"># The openmpi module is not loaded by default with R.</span>
module load openmpi/3.0.0

<span class="c1"># Always use -n 1 for the Rmpi package. It spawns additional processes</span>
<span class="c1"># dynamically</span>
mpirun -n <span class="m">1</span> R CMD BATCH --no-save --no-restore Rmpi.R
</code></pre></div>
<p>R script <code>Rmpi.R</code>:</p>
<div class="highlight"><pre><span></span><code>library(Rmpi)

# initialize an Rmpi environment
ns &lt;- 4
mpi.spawn.Rslaves(nslaves=ns)

# send these commands to the slaves
mpi.bcast.cmd( id &lt;- mpi.comm.rank() )
mpi.bcast.cmd( ns &lt;- mpi.comm.size() )
mpi.bcast.cmd( host &lt;- mpi.get.processor.name() )

# all slaves execute this command
mpi.remote.exec(paste(&quot;I am&quot;, id, &quot;of&quot;, ns, &quot;running on&quot;, host))

# close down the Rmpi environment
mpi.close.Rslaves(dellog = FALSE)
mpi.exit()
</code></pre></div>
<p>Output (trimmed for readability):</p>
<div class="highlight"><pre><span></span><code>    64 slaves are spawned successfully. 0 failed.
master  (rank 0 , comm 1) of size 65 is running on: midway449 
slave1  (rank 1 , comm 1) of size 65 is running on: midway449 
slave2  (rank 2 , comm 1) of size 65 is running on: midway449 
slave3  (rank 3 , comm 1) of size 65 is running on: midway449 
... ... ...
slave63 (rank 63, comm 1) of size 65 is running on: midway452 
slave64 (rank 64, comm 1) of size 65 is running on: midway449 
$slave1
[1] &quot;I am 1 of 65&quot;

$slave2
[1] &quot;I am 2 of 65&quot;

...

$slave63
[1] &quot;I am 63 of 65&quot;

$slave64
[1] &quot;I am 64 of 65&quot;
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>